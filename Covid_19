Worldwide > Looking at Death Percentage by Date
---- Show the highest death percentage by date
--SELECT date, SUM(new_cases) AS total_new_cases, SUM(new_deaths) AS total_new_deaths, (SUM(new_deaths)/SUM(new_cases)) * 100 AS death_perc
--FROM dbo.covid_deaths
--WHERE continent IS NOT NULL
--GROUP BY date
--ORDER BY death_perc DESC;

---- Worldwide > Looking at Death Percentage
--SELECT SUM(new_cases) AS total_new_cases, SUM(new_deaths) AS total_new_deaths, (SUM(new_deaths)/SUM(new_cases)) * 100 AS death_perc
--FROM dbo.covid_deaths
--WHERE continent IS NOT NULL
----GROUP BY date
--ORDER BY total_new_cases;

-- ***********************
-- ANALYSIS BY VACCINATION
-- ***********************

-- 10 Worldwide > Rolling Vaccinations by Country & Date
SELECT d.continent, d.location, d.date, d.population, v.new_vaccinations, 
	SUM(CONVERT(INT,v.new_vaccinations)) OVER (PARTITION BY d.location
	ORDER BY d.location, d.date) 
	AS rolling_vaccinations
-- Partition by location & date to ensure that once the rolling sum of new vaccinations for a location stops, the rolling sum starts for the next location
FROM dbo.covid_deaths AS d
JOIN dbo.covid_vaccs AS v
	ON d.location = v.location 
AND d.date = v.date
WHERE d.continent IS NOT NULL
ORDER BY d.location, d.date;

-- 11 Malaysia > Rolling Vaccinations by Date
SELECT d.continent, d.location, d.date, d.population, v.new_vaccinations, 
	SUM(CONVERT(INT,v.new_vaccinations)) OVER (PARTITION BY d.location
		ORDER BY d.location, d.date) AS rolling_vaccinations
FROM dbo.covid_deaths AS d
JOIN dbo.covid_vaccs AS v
	ON d.location = v.location 
	AND d.date = v.date
WHERE d.location = 'Malaysia'
ORDER BY d.location, d.date;



















